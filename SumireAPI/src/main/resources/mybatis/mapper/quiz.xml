<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tokyo.sumire.repository.QuizRepository">
	<resultMap type="tokyo.sumire.domain.QuizList" id="QuizInfoList">
		<result column="TOTAL_QUIZ_CNT" property="totalQuizCnt" />
		<collection property="quizList"
			ofType="tokyo.sumire.domain.Quiz">
			<id column="QUIZ_ID" property="quizId" />
			<result column="QUESTION" property="question" />
			<collection property="choices"
				ofType="tokyo.sumire.domain.Choice">
				<result column="NAME" property="name" />
				<result column="CHOICE_ID" property="choiceId" />
				<result column="IMAGE_URI" property="imageUri" />
				<result column="INFO_URI" property="infoUri" />
				<result column="CORRECT_FLG" property="correctFlg" />
				<result column="BUST" property="bust" />
				<result column="WEST" property="west" />
				<result column="HIP" property="hip" />
			</collection>
		</collection>
	</resultMap>

	<select id="getQuizList" resultMap="QuizInfoList">
		SELECT
			(
				SELECT
					COUNT(QUIZ_ID)
				FROM
					TBL_QUIZ
				WHERE
					PLAN_DAY BETWEEN #{startDate} AND #{endDate}
			) AS TOTAL_QUIZ_CNT,
			Q.QUIZ_ID AS QUIZ_ID,
			Q.QUESTION AS QUESTION,
			A.NAME AS NAME,
			C.CHOICE_ID AS CHOICE_ID,
			A.IMAGE_URI AS IMAGE_URI,
		    A.INFO_URI AS INFO_URI,
			C.CORRECT_FLG AS CORRECT_FLG,
			A.BUST AS BUST,
			A.WEST AS WEST,
			A.HIP AS HIP
		FROM
			TBL_QUIZ AS Q
		INNER JOIN TBL_CHOICE AS C
			ON Q.QUIZ_ID = C.QUIZ_ID
		INNER JOIN TBL_ACTRESS AS A
			ON C.ACTRESS_ID = A.ACTRESS_ID
		WHERE
			Q.PLAN_DAY BETWEEN #{startDate} AND #{endDate};
	</select>
</mapper>